
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>HealthBridge AI</title>
    
    <!-- CSS & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #fff; margin: 0; overscroll-behavior-y: contain; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(14px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .metric-glow { box-shadow: 0 0 40px rgba(37, 99, 235, 0.2); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0.02) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.02) 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite linear;
        }
        .ai-border { border: 1px solid rgba(59, 130, 246, 0.3); background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(37, 99, 235, 0.05)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { GoogleGenAI } from "@google/genai";

        const { useState, useEffect, useCallback, useRef } = React;

        // --- COMPONENTS ---
        const MetricCard = ({ label, value, unit, icon, color, isLoading }) => (
            <div className={`glass p-5 rounded-[2rem] border-l-4 ${color} transition-all active:scale-95 ${isLoading ? 'shimmer' : ''}`}>
                <div className="flex justify-between items-start mb-4">
                    <span className="text-gray-500 text-[10px] font-black uppercase tracking-widest">{label}</span>
                    <i className={`fa-solid ${icon} text-lg opacity-40`}></i>
                </div>
                <div className="flex items-baseline gap-1">
                    {isLoading ? (
                        <div className="h-8 w-16 bg-white/10 rounded-lg animate-pulse"></div>
                    ) : (
                        <>
                            <span className="text-3xl font-black tracking-tighter">{value}</span>
                            <span className="text-gray-500 text-[10px] font-bold uppercase">{unit}</span>
                        </>
                    )}
                </div>
            </div>
        );

        // --- APP ---
        const App = () => {
            const [metrics, setMetrics] = useState({
                heartRate: 0, spO2: 0, steps: 0, stress: 0, sleep: 0, timestamp: '--'
            });
            const [isInitialLoading, setIsInitialLoading] = useState(true);
            const [isLive, setIsLive] = useState(true);
            const [status, setStatus] = useState('IDLE');
            const [aiInsight, setAiInsight] = useState("Your Galaxy Watch 7 is calibrating LTE sensors. Tap 'Push Data' for a deep AI health analysis.");
            const [isAiGenerating, setIsAiGenerating] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);

            // SIMULATED HARDWARE BRIDGE
            const fetchWatchData = useCallback(async () => {
                setIsInitialLoading(true);
                setStatus('SYNCING');
                await new Promise(r => setTimeout(r, 1800));
                
                setMetrics({
                    heartRate: 65 + Math.floor(Math.random() * 15),
                    spO2: 97 + Math.floor(Math.random() * 3),
                    steps: 4200 + Math.floor(Math.random() * 1000),
                    stress: 20 + Math.floor(Math.random() * 20),
                    sleep: (7 + Math.random()).toFixed(1),
                    timestamp: new Date().toLocaleTimeString()
                });
                setIsInitialLoading(false);
                setStatus('IDLE');
            }, []);

            useEffect(() => { fetchWatchData(); }, [fetchWatchData]);

            // Real-time Updates
            useEffect(() => {
                if (!isLive || isInitialLoading) return;
                const timer = setInterval(() => {
                    setMetrics(prev => ({
                        ...prev,
                        heartRate: Math.max(60, Math.min(100, prev.heartRate + (Math.random() - 0.5) * 4)),
                        timestamp: new Date().toLocaleTimeString()
                    }));
                }, 5000);
                return () => clearInterval(timer);
            }, [isLive, isInitialLoading]);

            // AI Insight Logic
            const generateAIInsight = async (currentMetrics) => {
                setIsAiGenerating(true);
                try {
                    const ai = new GoogleGenAI({ apiKey: window.process?.env?.API_KEY || "" });
                    const response = await ai.models.generateContent({
                        model: "gemini-3-flash-preview",
                        contents: `Analyze these Galaxy Watch 7 metrics: ${JSON.stringify(currentMetrics)}. 
                        Provide one short, encouraging health insight (max 120 characters).`,
                    });
                    setAiInsight(response.text || "Metrics processed. Recovery is trending positive.");
                } catch (err) {
                    console.error("AI Error:", err);
                    setAiInsight("Push complete. Your metrics are within healthy operational ranges.");
                } finally {
                    setIsAiGenerating(false);
                }
            };

            const handlePush = async () => {
                setStatus('PUSHING');
                await new Promise(r => setTimeout(r, 1200));
                setStatus('ANALYZING');
                await generateAIInsight(metrics);
                setStatus('SUCCESS');
                setTimeout(() => setStatus('IDLE'), 2000);
            };

            // PWA Setup
            useEffect(() => {
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                });
            }, []);

            const installApp = async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') setDeferredPrompt(null);
            };

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto bg-[#050505] relative overflow-hidden">
                    {/* Status Bar Backdrop */}
                    <div className="h-6 w-full fixed top-0 bg-black/80 backdrop-blur-md z-[60]"></div>

                    <header className="p-6 mt-6 flex items-center justify-between sticky top-6 bg-black/40 backdrop-blur-2xl z-50 border-b border-white/5">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center metric-glow">
                                <i className="fa-solid fa-bolt-lightning text-white text-lg"></i>
                            </div>
                            <div>
                                <h1 className="text-xl font-black tracking-tighter">HealthBridge</h1>
                                <div className="flex items-center gap-1.5">
                                    <div className={`w-1.5 h-1.5 rounded-full pulse ${isInitialLoading ? 'bg-amber-500' : 'bg-green-500'}`}></div>
                                    <span className="text-[10px] font-black text-gray-500 uppercase tracking-widest">
                                        {isInitialLoading ? 'Connecting...' : 'LTE: Samsung GW7'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 p-5 space-y-4 pb-36 overflow-y-auto custom-scroll">
                        <div className="grid grid-cols-2 gap-3">
                            <MetricCard label="Heart Rate" value={Math.round(metrics.heartRate)} unit="BPM" icon="fa-heart-pulse" color="border-rose-500" isLoading={isInitialLoading} />
                            <MetricCard label="SpO2" value={metrics.spO2} unit="%" icon="fa-droplet" color="border-cyan-400" isLoading={isInitialLoading} />
                            <MetricCard label="Daily Steps" value={metrics.steps.toLocaleString()} unit="Steps" icon="fa-fire-flame-curved" color="border-orange-500" isLoading={isInitialLoading} />
                            <MetricCard label="Stress" value={Math.round(metrics.stress)} unit="/100" icon="fa-wave-square" color="border-indigo-500" isLoading={isInitialLoading} />
                        </div>

                        {/* Sleep Panel */}
                        <div className={`glass p-6 rounded-[2.5rem] border-l-4 border-purple-500 ${isInitialLoading ? 'shimmer opacity-50' : ''}`}>
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h3 className="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1">Last Sleep Cycle</h3>
                                    <p className="text-3xl font-black tracking-tighter">{metrics.sleep} <span className="text-xs text-gray-500 font-bold">HRS</span></p>
                                </div>
                                <div className="w-12 h-12 rounded-2xl bg-purple-500/10 flex items-center justify-center">
                                    <i className="fa-solid fa-moon text-purple-400 text-xl"></i>
                                </div>
                            </div>
                            <div className="h-2 w-full bg-white/5 rounded-full overflow-hidden flex gap-1">
                                <div className="h-full bg-purple-600 w-1/4 rounded-full"></div>
                                <div className="h-full bg-blue-500 w-1/2 rounded-full"></div>
                                <div className="h-full bg-blue-300 w-1/4 rounded-full"></div>
                            </div>
                        </div>

                        {/* AI Section */}
                        <div className={`glass ai-border p-6 rounded-[2.5rem] shadow-2xl transition-all duration-700 ${isInitialLoading ? 'opacity-30 scale-95' : 'opacity-100'}`}>
                            <div className="flex items-center gap-2 mb-3">
                                <div className="w-6 h-6 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                    <i className="fa-solid fa-sparkles text-blue-400 text-[10px]"></i>
                                </div>
                                <h3 className="text-[10px] font-black uppercase tracking-widest text-blue-300">Live AI Analysis</h3>
                            </div>
                            <div className={`transition-all duration-300 ${isAiGenerating ? 'blur-sm' : ''}`}>
                                <p className="text-xs text-gray-300 leading-relaxed font-medium">
                                    "{aiInsight}"
                                </p>
                            </div>
                            {isAiGenerating && (
                                <div className="mt-3 flex gap-1">
                                    <div className="w-1 h-1 bg-blue-500 rounded-full animate-bounce"></div>
                                    <div className="w-1 h-1 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.15s]"></div>
                                    <div className="w-1 h-1 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.3s]"></div>
                                </div>
                            )}
                        </div>
                    </main>

                    {/* Bottom Dock */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-black/80 backdrop-blur-3xl border-t border-white/5 p-4 pb-10 z-50">
                        <div className="flex items-center justify-between gap-4 max-w-md mx-auto">
                            <button onClick={() => setIsLive(!isLive)} className={`w-14 h-14 rounded-2xl flex flex-col items-center justify-center transition-all ${isLive ? 'text-blue-500 bg-blue-500/5' : 'text-gray-600 bg-white/5'}`}>
                                <i className={`fa-solid ${isLive ? 'fa-tower-broadcast' : 'fa-pause'} text-xl mb-1`}></i>
                                <span className="text-[8px] font-black uppercase">{isLive ? 'Live' : 'Off'}</span>
                            </button>
                            
                            <button 
                                onClick={handlePush}
                                disabled={status !== 'IDLE' || isInitialLoading}
                                className={`flex-1 h-14 rounded-2xl font-black uppercase tracking-widest flex items-center justify-center gap-3 transition-all active:scale-95 shadow-xl
                                    ${(status === 'IDLE' && !isInitialLoading) ? 'bg-blue-600 text-white' : 'bg-white/5 text-gray-500'}
                                `}
                            >
                                {status === 'IDLE' ? (
                                    isInitialLoading ? (
                                        <><i className="fa-solid fa-satellite-dish animate-pulse"></i><span>Syncing</span></>
                                    ) : (
                                        <><i className="fa-solid fa-cloud-arrow-up"></i><span>Push Data</span></>
                                    )
                                ) : (
                                    <><i className="fa-solid fa-circle-notch animate-spin"></i><span>{status}</span></>
                                )}
                            </button>
                        </div>
                    </nav>

                    {/* Install Overlay */}
                    {deferredPrompt && (
                        <div className="fixed bottom-28 left-4 right-4 z-[100] animate-bounce-in">
                            <div className="bg-blue-600 rounded-[2rem] p-5 flex items-center justify-between shadow-2xl border border-white/10">
                                <div className="flex items-center gap-4">
                                    <div className="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center text-white">
                                        <i className="fa-solid fa-mobile-button"></i>
                                    </div>
                                    <p className="text-white font-black text-[10px] uppercase tracking-widest">Install for LTE Alerts</p>
                                </div>
                                <button onClick={installApp} className="bg-white text-blue-600 px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-tighter">Install</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Register SW
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(() => {});
            });
        }
    </script>
</body>
</html>
